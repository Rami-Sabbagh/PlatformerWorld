--Author : Ramilego4Game - This File Is Part Of Platformer World--
--Type : Class/Screen--
--Imports--
require "Modes.DGame"
LevelEditor = class:new()

function LevelEditor:init()
  self.fadeScreen, self.alpha, self.speed = true, 255, 25
  
  love.physics.setMeter(64)
  _World =  love.physics.newWorld(0, 9.81*64, true)
  
  self.map, self.TilesList = {}, {}
  
  self:createTopBar()
  
  self:FillTilesList()
end

function LevelEditor:update(dt)
  
end

function LevelEditor:draw()
  love.graphics.setColor(255,255,255,255)
  UI:DrawBackground("Background")
  UI:DrawGuide()
end

function LevelEditor:fade()
  if self.fadeScreen then
    love.graphics.setColor(0,0,0,self.alpha)
    love.graphics.rectangle("fill",0,0,love.graphics.getWidth(),love.graphics.getHeight())
    self.alpha = self.alpha - self.speed
    if self.alpha <= 0 then
      self.fadeScreen = false
      self.alpha = 255
    end
    love.graphics.setColor(255,255,255,255)
  end
end

function LevelEditor:createTopBar()
  if self.fr == nil then self.fr = {} end
  self.fr.topBar = {}
  self.fr.topBar.Panel = loveframes.Create("panel")
  self.fr.topBar.Panel:SetSize(love.graphics.getWidth(),30)
  
  self.fr.topBar.Test = loveframes.Create("button",self.fr.topBar.Panel)
  self.fr.topBar.Test:SetPos(3,3):SetSize(64,24):SetText("Test")
  self.fr.topBar.Test.OnClick = function(object)
    self:Destroy()
    mode = DGame:new(self.map)
  end
  
  self.fr.topBar.MenuPanel = loveframes.Create("panel")
  self.fr.topBar.MenuPanel:SetPos(love.graphics.getWidth()-250,30):SetSize(250,love.graphics.getHeight()-30)
  
  self.fr.topBar.MenuTiles = loveframes.Create("list",self.fr.topBar.MenuPanel)
  self.fr.topBar.MenuTiles:SetPos(5,5):SetSize(240,love.graphics.getHeight()-40)
  self.fr.topBar.MenuTiles:EnableHorizontalStacking(true):SetPadding(10):SetSpacing(10)
  
  self.fr.topBar.MenuToggle = loveframes.Create("button",self.fr.topBar.Panel)
  self.fr.topBar.MenuToggle:SetPos(self.fr.topBar.Panel:GetWidth()-103,3):SetSize(100,24):SetText("Toggle Menu")
  self.fr.topBar.MenuToggle.OnClick = function(object)
    self.fr.topBar.MenuPanel:SetVisible(not self.fr.topBar.MenuPanel:GetVisible())
  end
end

function LevelEditor:FillTilesList()
  local files = loveframes.util.GetDirectoryContents("Engine/Tiles/")
	for k, v in ipairs(files) do
		if v.extension == "lua" then
			require(v.requirepath)
      table.insert(self.TilesList,Tile:new())
      Tile = nil
		end
	end
  
  for k,v in pairs(self.TilesList) do
    local button = loveframes.Create("imagebutton")
    button:SetImage(_Images[v.thumbnail or v.hover]):SizeToImage():SetText("")
    
    local X = 0--button:GetX()+button:GetWidth()-10
    local Y = 43--button:GetY()+button:GetHeight()-10
    
    local tooltip = loveframes.Create("tooltip")
    tooltip:SetObject(button):SetOffsets(X,Y):SetText(v.name or "Unkown")
    
    self.fr.topBar.MenuTiles:AddItem(button)
    
    button, tooltip = nil, nil
  end
end

function LevelEditor:Destroy()
  if self.fr then
    if self.fr.topBar then
      for k,v in pairs(self.fr.topBar) do
        v:Remove()
        self.fr.topBar[k] = nil
      end
      self.fr.topBar = nil
    end
    for k,v in pairs(self.fr) do
        v:Remove()
        self.fr[k] = nil
    end
  end
end